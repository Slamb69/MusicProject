{% extends 'base.html' %}

<head>
    <title>{% block title %}{{ (piece.title) }}{% endblock%}</title>
</head>

{% block content %}
<div> 
  <h2>{{ piece.title }}
    <span class="btnToggle">
      {% if piece.is_users_piece(session.get('user_id')) %}
        <button name="upiecedel" class="del_upiece" data-pieceId="{{ piece.piece_id }}">Remove from Library</button>
      {% else %}
        <button name="upieceadd" class="add_upiece" data-pieceId="{{ piece.piece_id }}">Add to Library</button>
      {% endif %}
    </span>
  </h2>

  <ul style="list-style-type:none">
    <li>Title: {{ piece.title }}</li>
    <li>Composer: {{ piece.composer }}</li>
    <li>Lyricist: {{ piece.lyricist|none_filter }}</li>
    <li>Genre: {% for genre in piece.piece_genres %} 
                {{ genre.genre.name }} {% endfor %}</li>
    <li>Publication Year: {{ piece.publication_year|none_filter }}</li>
    <li>Number of voices: {{ piece.original_num_voices|none_filter }}</li>
    <li>Original Voicing: {{ piece.original_voicing|none_filter }}</li>
    <li>Original Language: {{ piece.original_language|none_filter }}</li>
    <li>Instrumentation: {{ piece.original_language|none_filter }}</li>
    <li>Description: {{ piece.description|none_filter }}</li>
    <li>CPDL Page: {{ piece.page_id }}</li>

  </ul>
</div>
  {% if piece.sheets %}
    <div><h3>Sheet music versions:</h3>
      <ul style="list-style-type:none">{% for sheet in piece.sheets %}
        <li><a href="/sheets/{{ sheet.sheet_id }}">{{ sheet.edition_notes }}
          (ID #:{{ sheet.sheet_id }})
           </a></li>
      {% endfor %}</ul>
    </div>
  
  {% endif %}
    {% if piece.text_original %}
    <div><h3>Original {{ piece.original_language }} Text:</h3>
      <div>{{ piece.text_original|safe }}</div>
    </div>
  {% endif %}

  {% if piece.text_english %}
    <div><h3>English Translation:</h3>
      <div>{{ piece.text_english|safe }}</div>
    </div>
  {% endif %}

<script type="text/javascript">
"use strict";

// Success function when item added to or deleted from user's library.
function alertLibraryResult(result) {
    alert(result.message);
    $('btnToggle').load(result.in_db)
}

// event listener & handler to delete Piece from UserPiece library.
$(".del_upiece").on("click", function (evt) {

    var formInput = {"piece_id": $(evt.currentTarget).data("pieceid")};

    // console.log(evt.currentTarget);
    // console.log(formInput);

    $.post("/del_upiece.json",
           formInput,
           alertLibraryResult);
});

// event listener & handler to add Piece to UserPiece library.
$(".add_upiece").on("click", function (evt) {

    var formInput = {"piece_id": $(evt.currentTarget).data("pieceid")};

    // console.log(evt.currentTarget);
    // console.log(formInput);

    $.post("/add_upiece.json",
           formInput,
           alertLibraryResult);
});
</script>

{% endblock %}